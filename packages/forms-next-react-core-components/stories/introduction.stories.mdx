import {Meta, Story} from '@storybook/addon-docs';
import {AdaptiveForm} from "@aemforms/forms-super-component";

<Meta title="Adaptive Form/Introduction" component={AdaptiveForm} />

# What is Headless Adaptive Form

Headless Adaptive Form (HAF) specifies a mechanism to create a Form or Data Capture Experience using a JSON representation,
which allows rendering that experience across multiple channels.

The [Adaptive Form Specification](https://git.corp.adobe.com/pages/livecycle/af2-docs/spec/latest/)
can be used by implementors to generate a visual appearance for the Data Capture Experience for multiple channels.

# Modules

The HAF is mainly made up of these components

* A Specification that details how a form with its dynamic behaviour can be represented in JSON.
* A Core Library (@aemforms/forms-core) that understands the dynamic behaviour and manipulates the state of the Form
without the need of a User Interface.
* An Adaptive Form Super Component that takes the form json and renders it using react spectrum components.

# Getting Started

## Prerequisites

The assumption is that you have node > 16 and npm > 8 installed on your machine and
created a react project (using react version ^16.14.0). There are multiple ways to do that
(create-react-app, webpack, etc.).

Once you have your React project ready you need to install the following dependencies

```
npm i --save @aemforms/forms-super-component @aemforms/forms-react-components @adobe/react-spectrum @react/react-spectrum
```

The above command might fail since it requires access to Adobe VPN and artifactory. If it fails, you need to log into
Adobe's VPN and authenticate with artifactory

### Authenticate with artifactory

Create a `.npmrc` file with the following repositories (or copy the file present
[here](https://git.corp.adobe.com/livecycle/af2-web-runtime/blob/main/.npmrc))

```
@aemforms:registry=https://artifactory.corp.adobe.com/artifactory/api/npm/npm-aem-release/
@react:registry=https://artifactory.corp.adobe.com/artifactory/api/npm/npm-react-release/
@quarry:registry=https://artifactory.corp.adobe.com/artifactory/api/npm/npm-adobe-release-local/
//artifactory.corp.adobe.com/artifactory/api/npm/npm-adobe-release-loca/:_auth=${NPM_TOKEN}
//artifactory.corp.adobe.com/artifactory/api/npm/npm-aem-release/:_auth=${NPM_TOKEN}
//artifactory.corp.adobe.com/artifactory/api/npm/npm-react-release/:_auth=${NPM_TOKEN}
_auth=${NPM_TOKEN}
email=${NPM_EMAIL}
always-auth=true
```

Then before running the installation authenticate with artifactory

```
auth=$(curl -s -u${ARTIFACTORY_USER}:${ARTIFACTORY_API_TOKEN} https://artifactory.corp.adobe.com/artifactory/api/npm/auth)
export NPM_TOKEN=$(echo "${auth}" | grep "_auth" | awk -F " " '{ print $3 }')
export NPM_EMAIL=$(echo "${auth}" | grep "email" | awk -F " " '{ print $3 }')
```

## Form JSON

One needs to define The Form in JSON as per the
[Specification](https://git.corp.adobe.com/pages/livecycle/af2-docs/spec/latest/).

## Mappings Object

A Mappings Object is a JavaScript map that maps the
[field types](https://git.corp.adobe.com/pages/livecycle/af2-docs/spec/latest/#field-properties-fieldType)
defined in the Specification to its respective React Component. The Adaptive Form Super Component
uses this map to render the different components defined in the Form JSON.

The default mappings can be found in
[git](https://git.corp.adobe.com/livecycle/af2-web-runtime/blob/main/packages/forms-next-react-core-components/src/utils/mappings.ts)

To use that in your project use the following import, assuming you have added the project as a dependency in your project

```
import {mappings} from '@aemforms/forms-react-components'
```

Once you have defined the JSON for the form, the code would look like

```
import {mappings} from '@aemforms/forms-react-components'
const json = {...}
<AdaptiveForm mappings={mappings} formJson={json} />
```

If you are not using React Spectrum then you might need to start your app with the
[React Spectrum Provider](https://react-spectrum.adobe.com/react-spectrum/getting-started.html#setting-up-your-app).

If you are not using Provider at your app level, you can use that with the Adaptive Form Super Component

```
import {mappings} from '@aemforms/forms-react-components'
import { Provider as Spectrum3Provider, defaultTheme } from '@adobe/react-spectrum'
const json = {...}
<SpectrumProvider theme={defaultTheme}>
<AdaptiveForm mappings={mappings} formJson={json} />
</SpectrumProvider>
```


# Examples

A simple one field form will have the following representation

<Story id="reference-examples--introduction" />


Additional capabilities including submission and multiple fields can be added in the JSON itself. The data can be
extracted out at submit using the callbacks provided by the Adaptive Form Super Component

<Story id="reference-examples--form-data" />


The Form can also generate a hierarchical data

<Story id="reference-examples--nested-data" />


# How to read the storybook

The storybook demonstrates the properties of the JSON specification and the capabilities that the super component adds
on.

The storybook is divided into different chapters

## Chapter 1. Form Fields and Panels

The chapter deals with different types of fields in the form and how they can be defined and what capabilities they
provide. There are two types of components in the Form: Fields and Panels.

A Field is the unit entity in the Form Document and is represented as a JSON Object.
A field can specify one or more of,

* constraints on the data they capture,
* dynamic rules to change their state they have including visibility, enabled, etc.,
* label, help text, etc.,
* handling of any events that can be performed by the end user, like click, change etc.

A Form Panel is an entity to group a set of fields logically (to create a complex data type) or visually.

## Chapter 2. Form Layouts

The Panels in addition to group fields, can also be used to provide a layout to the form as well. The second chapter
deals with the different kind of layout, that

Note that layout is not defined in the Form Specification, but is extended by the Adaptive Form Super Component
to provide basic layout capabilities

## Chapter 3. Form Validation

A user can specify multiple constraints in the fields and those constraints are validated whenever the user is entering
the data in the field.

## Chapter 4. Dynamic Behaviour

A Form can have a dynamic behaviour, which may include (and the list is not exhaustive)

* Spouse Name is mandatory if the Marital Status is married
* Show/Enable the submit button only if user agrees to the Terms of the Document
* Compute Total Field in the purchase order form as user enters details.
* Uppercase the values when the user exits from a field
* Allow adding dependent information for the number of dependents user has chosen

## Chapter 5. Advanced Usage